<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8' />
<title>Change a map's style</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.css' rel='stylesheet' />
<style>
body { margin:0; padding:0; }
#map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>
<body>
 
<style>
    #menu {
        background: #fff;
        position: absolute;
        z-index: 1;
        top: 10px;
        right: 10px;
        border-radius: 3px;
        width: 120px;
        border: 1px solid rgba(0,0,0,0.4);
        font-family: 'Open Sans', sans-serif;
    }
 
    #menu a {
        font-size: 13px;
        color: #404040;
        display: block;
        margin: 0;
        padding: 0;
        padding: 10px;
        text-decoration: none;
        border-bottom: 1px solid rgba(0,0,0,0.25);
        text-align: center;
    }
 
    #menu a:last-child {
        border: none;
    }
 
    #menu a:hover {
        background-color: #f8f8f8;
        color: #404040;
    }
 
    #menu a.active {
        background-color: #3887be;
        color: #ffffff;
    }
 
    #menu a.active:hover {
        background: #3074a4;
    }
</style>


<nav id="menu"></nav> 
<div id='map'></div>
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoibW1hbzk1IiwiYSI6ImNqdXB0eHoxZjNlM200M25xZHgzMG82cDgifQ.Q2_T7ErCmRmP7Lpf26T1fg';
var map = new mapboxgl.Map({
container: 'map',
style: 'mapbox://styles/mapbox/light-v10',
zoom: 13,
center: [-71.06, 42.35]
});

var ziplist = ["02108", "02109", "02110", "02111", "02113", "02114", "02115", "02116", "02118", "02119", "02120", "02121", "02122", "02124", "02125", "02126", "02127", "02128", "02129", "02130", "02131", "02132", "02134", "02135", "02136", "02151", "02152", "02163", "02199", "02203", "02210", "02215", "02467"]

var getColorMap = function(){
    list = []
    list.push("match")
    list.push(["get","ZIP5"])
    for (zip in ziplist){
        list.push(ziplist[zip])
        list.push(getRandomColor())
    }
    list.push('#66ccff')
    return list
}

var getRandomColor = function(){
  return '#'+('00000'+ (Math.random()*0x1000000<<0).toString(16)).substr(-6); 
}

map.on('load', function() { 
    map.addSource('SS', { 
        "type": "geojson", 
        "data": "http://datamechanics.io/data/street.geojson"
    });
    map.addSource('ZIP', { 
        "type": "geojson", 
        "data": "http://datamechanics.io/data/ZIP_Codes.geojson"
    });
    map.addSource('CAN', { 
        "type": "geojson", 
        "data": "http://datamechanics.io/data/candidates.geojson"
    });


    map.addLayer({ 
        "id": "zipcode", 
        "source": "ZIP", 
        "type": "fill", 
        "paint": {
            "fill-color": getColorMap(),
            "fill-opacity": 0.8
        }
    }); 
    map.addLayer({ 
        "id": "candidate", 
        "source": "CAN", 
        "type": "line", 
        "layout": {
            "visibility": "visible",
            "line-join": "round",
            "line-cap": "round"
        },
        "paint": {
            "line-color": "#fff",
            "line-width": 3
        }
    }); 
    map.addLayer({ 
        "id": "clusters", 
        "source": "SS", 
        "type": "circle",
        "layout": {
            "visibility": "none"
        }, 
        "paint": { 
            "circle-radius": 3,
            "circle-color": [
                "match",
                ["get", "Cluster"],
                0,"#F1C40F",
                1,"#800080",
                2,"#EC7063",
                3,"#85C1E9",
                4,"#F1C40F",
                6,"#EC7063",
                7,"#85C1E9",
                8,"#F1C40F",
                9,"#EC7063",
                10,"#85C1E9",
                12,"#A3E4D7",
                13,"#EC7063",
                15,"#85C1E9",
                16,"#F1C40F",
                17,"#EC7063",
                19,"#85C1E9",
                20,"#A3E4D7",
                21,"#EC7063",
                23,"#85C1E9",
                24,"#F1C40F",
                25,"#EC7063",
                26,"#85C1E9",
                27,"#F1C40F",
                28,"#EC7063",
                30,"#A3E4D7",
                31,"#EC7063",
                33,"#F1C40F",
                34,"#85C1E9",
                /*other*/ "#800080"
            ]
     },
     "filter": ["==", "$type", "Point"],
    }); 
}); 

var toggleableLayerIds = [ 'candidate', 'clusters' ];
 
for (var i = 0; i < toggleableLayerIds.length; i++) {
    var id = toggleableLayerIds[i];
 
    var link = document.createElement('a');
    link.href = '#';
    link.className = 'active';
    link.textContent = id;
 
    link.onclick = function (e) {
        var clickedLayer = this.textContent;
        e.preventDefault();
        e.stopPropagation();
 
        var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
 
        if (visibility === 'visible') {
            map.setLayoutProperty(clickedLayer, 'visibility', 'none'); 
            this.className = '';
        } else {
            this.className = 'active';
            map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
        }
    };
 
    var layers = document.getElementById('menu');
    layers.appendChild(link);
}
</script>
 
</body>
</html>